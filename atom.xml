<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://evansalien.github.io</id>
    <title>Evans Alien</title>
    <updated>2020-03-09T01:18:02.228Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://evansalien.github.io"/>
    <link rel="self" href="https://evansalien.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://evansalien.github.io/images/avatar.png</logo>
    <icon>https://evansalien.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, Evans Alien</rights>
    <entry>
        <title type="html"><![CDATA[JavaScript ä¸­çš„ call, apply, bind]]></title>
        <id>https://evansalien.github.io/post/javascript_call-apply-bind/</id>
        <link href="https://evansalien.github.io/post/javascript_call-apply-bind/">
        </link>
        <updated>2020-03-06T06:57:10.000Z</updated>
        <content type="html"><![CDATA[<h1 id="call-apply-binåŒºåˆ«">callã€apply ã€ binåŒºåˆ«</h1>
<h2 id="call-call-æ–¹æ³•åœ¨ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„-this-å€¼å’Œè‹¥å¹²ä¸ªæŒ‡å®šçš„å‚æ•°å€¼çš„å‰æä¸‹è°ƒç”¨æŸä¸ªå‡½æ•°æˆ–æ–¹æ³•">call: call() æ–¹æ³•åœ¨ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„ this å€¼å’Œè‹¥å¹²ä¸ªæŒ‡å®šçš„å‚æ•°å€¼çš„å‰æä¸‹è°ƒç”¨æŸä¸ªå‡½æ•°æˆ–æ–¹æ³•ã€‚</h2>
<pre><code class="language-javascript">  var foo = {
    value: 1,
  };

  function bar() {
    console.log(this.value);
  }

  bar.call(foo); // 1

  // 1. call æ”¹å˜äº†thisçš„æŒ‡å‘ï¼ŒæŒ‡å‘åˆ°äº†foo

  // 2. bar å‡½æ•°æ‰§è¡Œäº†
</code></pre>
<p><strong>æ¨¡æ‹Ÿå®ç°call</strong></p>
<pre><code class="language-javascript">  // å¦‚ä½•æ¨¡æ‹Ÿä¸Šé¢è¿™ä¸¤ä¸ªæ­¥éª¤å‘¢ï¼Ÿ

  // è¯•æƒ³è°ƒç”¨callçš„æ—¶å€™ï¼ŒæŠŠfooå¯¹è±¡è¯¥æ‰¾æˆå¦‚ä¸‹æ•ˆæœ

  var foo = {
    value: 1,
    bar: function () {
      console.log(this.value)
    }
  };

  foo.bar(); // 1

  // è¿™ä¸ªæ—¶å€™ this å°±æŒ‡å‘äº† fooï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Ÿ

  // ä½†æ˜¯è¿™æ ·å´ç»™ foo å¯¹è±¡æœ¬èº«æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œè¿™å¯ä¸è¡Œå‘ï¼

  // ä¸è¿‡ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬ç”¨ delete å†åˆ é™¤å®ƒä¸å°±å¥½äº†~

  // æ‰€ä»¥å¯ä»¥æ¨¡æ‹Ÿæ‹†åˆ†æ­¥éª¤

  // 1. å°†å‡½æ•°è®¾ä¸ºå¯¹è±¡çš„å±æ€§ foo.fn = bar

  // 2. æ‰§è¡Œè¯¥å‡½æ•° foo.fn()

  // 3. åˆ é™¤è¯¥å‡½æ•° delete foo.fn

  Function.prototype.call1 = function(context) {
    context.fn = this;
    context.fn();
    delete context.fn;
  }

  // æµ‹è¯•ä¸€ä¸‹
  var foo = {
    value: 1
  };
  
  function bar () {
    console.log(this.value)
  }

  bar.call1(foo); // 1

  // æ­£å¥½å¯ä»¥æ‰“å°1ï¼Œé‚£å¦‚æœä¼ å…¥å¤šä¸ªå‚æ•°å‘¢ï¼Ÿ

  // æˆ‘ä»¬å¯ä»¥ä» Arguments å¯¹è±¡ä¸­å–å€¼ï¼Œå–å‡ºç¬¬äºŒä¸ªåˆ°æœ€åä¸€ä¸ªå‚æ•°ï¼Œç„¶åæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œ

  Function.prototype.call2 = function(context) {
    var context = context || window; // å¦‚æœä¸ä¼ åˆ™thisä¸ºwindow
    context.fn = this

    var arg = [];
    for (var i = 1, len = arguments.length; i &lt; len; i++) {
      args.push('arguments[' + i + ']');
    }

    var result = eval('context.fn(' + args +')');

    delete context.fn
    return result;
  }

  // æµ‹è¯•ä¸€ä¸‹
  var value = 2;

  var obj = {
      value: 1
  }

  function bar(name, age) {
      console.log(this.value);
      return {
          value: this.value,
          name: name,
          age: age
      }
  }

  bar.call(null); // 2

  console.log(bar.call2(obj, 'kevin', 18));
  // 1
  // Object {
  //    value: 1,
  //    name: 'kevin',
  //    age: 18
  // }

</code></pre>
<p><strong>æ¨¡æ‹Ÿå®ç°applay</strong></p>
<pre><code class="language-javascript">  // å…¶å®applyçš„å®ç°è·Ÿcallç±»ä¼¼
  
  Function.prototype.apply1 = function(context, arr) {
    var context = Object(ocntext) || window;
    context.fn = this;

    var result;
    if (!arr) {
      result = context.fn();
    } else {
      var arg = [];
      for (var i = 0, len = arr.length; i &lt; len; i++) {
            args.push('arr[' + i + ']');
        }
      result = eval('context.fn(' + args + ')')
    }

    delete context.fn
    return result;
  }

</code></pre>
<h2 id="bind-bind-æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°-å½“è¿™ä¸ªæ–°å‡½æ•°è¢«è°ƒç”¨æ—¶bind-çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä½œä¸ºå®ƒè¿è¡Œæ—¶çš„-thisä¹‹åçš„ä¸€åºåˆ—å‚æ•°å°†ä¼šåœ¨ä¼ é€’çš„å®å‚å‰ä¼ å…¥ä½œä¸ºå®ƒçš„å‚æ•°">bind: bind() æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚å½“è¿™ä¸ªæ–°å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œbind() çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä½œä¸ºå®ƒè¿è¡Œæ—¶çš„ thisï¼Œä¹‹åçš„ä¸€åºåˆ—å‚æ•°å°†ä¼šåœ¨ä¼ é€’çš„å®å‚å‰ä¼ å…¥ä½œä¸ºå®ƒçš„å‚æ•°ã€‚</h2>
<pre><code class="language-javascript">  // ç”±ä¸Šé¢çš„ä»‹ç»å¯ä»¥å¾—åˆ°ä¸¤ç‚¹çš„ç»“è®º

  // 1. è¿”å›ä¸€ä¸ªå‡½æ•°
  // 2. å¯ä»¥ä¼ å…¥å‡½æ•°

  var foo = {
    value: 1
  };

  function bar() {
    console.log(this.value);
  }

  var bindFoo = bar.bind1(foo);

  bindFoo() // 1

  Function.prototype.bind1 = function(context) {
    var self = this;
    return function() {
      self.apply(context);
    }
  }


  // å› ä¸º bind è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯: ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚

  // æ¢å¥è¯æ¥è¯´å½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œbind æ—¶æŒ‡å®šçš„ this å€¼ä¼šå¤±æ•ˆï¼Œä½†ä¼ å…¥çš„å‚æ•°ä¾ç„¶ç”Ÿæ•ˆã€‚ä¸¾ä¸ªä¾‹å­ï¼š

  var value = 2;

  var foo = {
      value: 1
  };

  function bar(name, age) {
      this.habit = 'shopping';
      console.log(this.value);
      console.log(name);
      console.log(age);
  }

  bar.prototype.friend = 'kevin';

  var bindFoo = bar.bind(foo, 'daisy');

  var obj = new bindFoo('18');
  // undefined
  // daisy
  // 18
  console.log(obj.habit);
  console.log(obj.friend);
  // shopping
  // kevin

  // å°½ç®¡åœ¨å…¨å±€å’Œ foo ä¸­éƒ½å£°æ˜äº† value å€¼ï¼Œæœ€åä¾ç„¶è¿”å›äº† undefindï¼Œè¯´æ˜ç»‘å®šçš„ this å¤±æ•ˆäº†

  // æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¿”å›å‡½æ•°çš„åŸå‹æ¥å®ç°

  Function.prototype.bind2 = function(context) {
    if (typeof this !== 'function') {
      throw new Error(&quot;Function.prototype.bind - what is trying to be bound is not callable&quot;);
    }
    var self = this;
    var args = Array.prototype.slice.call(arguments, 1);
    var fbound = function () {
      var bindArgs = Array.prototype.slice.call(arguments);
      // å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œself æŒ‡å‘ç»‘å®šå‡½æ•°ï¼Œå› ä¸ºä¸‹é¢ä¸€å¥ `fbound.prototype = this.prototype;`ï¼Œå·²ç»ä¿®æ”¹äº† fbound.prototype ä¸º ç»‘å®šå‡½æ•°çš„ prototypeï¼Œæ­¤æ—¶ç»“æœä¸º trueï¼Œå½“ç»“æœä¸º true çš„æ—¶å€™ï¼Œthis æŒ‡å‘å®ä¾‹ã€‚

      // å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œself æŒ‡å‘ç»‘å®šå‡½æ•°ï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå½“ç»“æœä¸º false çš„æ—¶å€™ï¼Œthis æŒ‡å‘ç»‘å®šçš„ contextã€‚
      self.apply(this instanceof self ? this : context, args.concat(bindArgs));
    }

    // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿å‡½æ•°çš„åŸå‹ä¸­çš„å€¼
    fbound.prototype = this.prototype;

    return fbound;
  }


</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JavaScript thiså…³é”®å­—]]></title>
        <id>https://evansalien.github.io/post/javascript_this/</id>
        <link href="https://evansalien.github.io/post/javascript_this/">
        </link>
        <updated>2020-03-05T06:59:17.000Z</updated>
        <content type="html"><![CDATA[<p>é¢å‘å¯¹è±¡è¯­è¨€ä¸­ this è¡¨ç¤ºå½“å‰å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚<br>
ä½†åœ¨ JavaScript ä¸­ this ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå®ƒä¼šéšç€æ‰§è¡Œç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ã€‚å…¶ä¸»è¦éšå¼ç»‘å®šåœºæ™¯è®¨è®ºï¼š</p>
<ol>
<li>å…¨å±€ä¸Šä¸‹æ–‡ğŸŒ²</li>
<li>ç›´æ¥å‡½æ•°è°ƒç”¨å’Œå¯¹è±¡æ–¹æ³•å½¢å¼è°ƒç”¨ğŸŒ³</li>
<li>DOMæ—¶é—´ç»‘å®šğŸ„</li>
<li>new æ„é€ å‡½æ•°ç»‘å®šğŸŒ´</li>
<li>ç®­å¤´å‡½æ•°ğŸŒ±</li>
</ol>
<h2 id="å…¨å±€ä¸Šä¸‹æ–‡">ğŸŒ²å…¨å±€ä¸Šä¸‹æ–‡</h2>
<blockquote>
<p>è¿™ä¸ªä¸ç”¨å¤šå°‘äº†å§ï¼Œé»˜è®¤æŒ‡å‘Window, ä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯ undefinedã€‚</p>
</blockquote>
<h2 id="ç›´æ¥å‡½æ•°è°ƒç”¨å’Œå¯¹è±¡æ–¹æ³•å½¢å¼è°ƒç”¨">ğŸŒ³ç›´æ¥å‡½æ•°è°ƒç”¨å’Œå¯¹è±¡æ–¹æ³•å½¢å¼è°ƒç”¨</h2>
<pre><code class="language-javascript">var obj = {
    fn: function() {
        console.log(this.a);
    },
    a: 1,
}
var a = 2;
var fn = obj.fn;
fn(); // 2
obj.fn(); // 1
</code></pre>
<blockquote>
<p>è¿™ç§ä¸¤ç§æƒ…å†µè°ƒç”¨ï¼Œ<strong>this</strong>ç›¸å½“äºæ˜¯<strong>Window</strong>å’Œ <strong>obj</strong>ã€‚</p>
</blockquote>
<h2 id="domäº‹ä»¶ç»‘å®š">ğŸ„DOMäº‹ä»¶ç»‘å®š</h2>
<blockquote>
<p>onclickå’ŒaddEventerListenerä¸­ this é»˜è®¤æŒ‡å‘ç»‘å®šäº‹ä»¶çš„å…ƒç´ ã€‚IEæ¯”è¾ƒå¥‡å¼‚ï¼Œä½¿ç”¨attachEventï¼Œé‡Œé¢çš„thisé»˜è®¤æŒ‡å‘windowã€‚</p>
</blockquote>
<h2 id="new-æ„é€ å‡½æ•°ç»‘å®š">ğŸŒ´ new æ„é€ å‡½æ•°ç»‘å®š</h2>
<blockquote>
<p>æ­¤æ—¶æ„é€ å‡½æ•°ä¸­çš„thisæŒ‡å‘å®ä¾‹å¯¹è±¡ã€‚</p>
</blockquote>
<h2 id="ç®­å¤´å‡½æ•°">ğŸŒ± ç®­å¤´å‡½æ•°</h2>
<blockquote>
<p>ç®­å¤´å‡½æ•°æ²¡æœ‰this, å› æ­¤ä¹Ÿä¸èƒ½ç»‘å®šã€‚é‡Œé¢çš„thisä¼šæŒ‡å‘å½“å‰æœ€è¿‘çš„éç®­å¤´å‡½æ•°çš„thisï¼Œæ‰¾ä¸åˆ°å°±æ˜¯window(ä¸¥æ ¼æ¨¡å¼æ˜¯undefined)ã€‚</p>
</blockquote>
<pre><code class="language-javascript">var obj = {
  a: function() {
    var fn = () =&gt; {
      console.log(this);
    }
    fn();
  }
}
obj.a(); // æ‰¾åˆ°æœ€è¿‘çš„éç®­å¤´å‡½æ•°aï¼Œaç°åœ¨ç»‘å®šç€obj, å› æ­¤ç®­å¤´å‡½æ•°ä¸­çš„thisæ˜¯obj
</code></pre>
]]></content>
    </entry>
</feed>