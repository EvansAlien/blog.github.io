<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vueåˆå§‹åŒ–åˆ°æœ€ç»ˆæ¸²æŸ“çš„è¿‡ç¨‹åˆ†æï¼ˆä¸€ï¼‰ | Evans Alien</title>
<link rel="shortcut icon" href="https://evansalien.github.io/favicon.ico?v=1584523308582">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://evansalien.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Vueåˆå§‹åŒ–åˆ°æœ€ç»ˆæ¸²æŸ“çš„è¿‡ç¨‹åˆ†æï¼ˆä¸€ï¼‰ | Evans Alien - Atom Feed" href="https://evansalien.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="æ¥æº
ä»æˆ‘æœ€è¿‘é¢è¯•çš„æƒ…å†µæ¥çœ‹ï¼ˆä¸‰å››å¹´çš„ç»éªŒï¼‰ï¼Œé¡¹ç›®ä¸­ç”¨Vueçš„æ—¶é—´ä¹Ÿä¸å°‘ï¼Œæˆ‘æŠ›å¼€å¸¸è§çš„é—®é¢˜ï¼Œé—®äº†ä»–ä»¬å¯¹äºVueçš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œéƒ½å›ç­”å¾ˆç†Ÿæ‚‰ï¼Œä»€ä¹ˆå·¥ç¨‹åŒ–ã€å…¨å®¶æ¡¶ã€è„šæ‰‹æ¶ç³»åˆ—çš„ã€‚æˆ‘å°±é—®äº†ä¸‹ Vueçš„æ¸²æŸ“è¿‡ç¨‹æˆ–è€…åœ¨Object.prototype.t..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://evansalien.github.io">
  <img class="avatar" src="https://evansalien.github.io/images/avatar.png?v=1584523308582" alt="">
  </a>
  <h1 class="site-title">
    Evans Alien
  </h1>
  <p class="site-description">
    æ¸©æ•…è€ŒçŸ¥æ–°
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Vueåˆå§‹åŒ–åˆ°æœ€ç»ˆæ¸²æŸ“çš„è¿‡ç¨‹åˆ†æï¼ˆä¸€ï¼‰
            </h2>
            <div class="post-info">
              <span>
                2020-03-16
              </span>
              <span>
                9 min read
              </span>
              
            </div>
            
              <img class="post-feature-image" src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1584533354826&amp;di=e4d3b5c383a82a9c4217cb7d0ddb9620&amp;imgtype=0&amp;src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20171230%2F5d148f5ba1d44552a72dd738a9b1dbd1.jpeg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h2 id="æ¥æº">æ¥æº</h2>
<p>ä»æˆ‘æœ€è¿‘é¢è¯•çš„æƒ…å†µæ¥çœ‹ï¼ˆä¸‰å››å¹´çš„ç»éªŒï¼‰ï¼Œé¡¹ç›®ä¸­ç”¨Vueçš„æ—¶é—´ä¹Ÿä¸å°‘ï¼Œæˆ‘æŠ›å¼€å¸¸è§çš„é—®é¢˜ï¼Œé—®äº†ä»–ä»¬å¯¹äºVueçš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œéƒ½å›ç­”å¾ˆç†Ÿæ‚‰ï¼Œä»€ä¹ˆå·¥ç¨‹åŒ–ã€å…¨å®¶æ¡¶ã€è„šæ‰‹æ¶ç³»åˆ—çš„ã€‚æˆ‘å°±é—®äº†ä¸‹ Vueçš„æ¸²æŸ“è¿‡ç¨‹æˆ–è€…åœ¨Object.prototype.toString.call(Vue)æ˜¯ä»€ä¹ˆï¼Ÿ ğŸ˜±WHAT ? é¢ï¼Œå¾ˆå¤šäººä¸€ä¸‹å›ç­”ä¸ä¸Šæ¥ã€‚ä¸æ€¥ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ…¢æ…¢çš„æ¢ç©¶ä¸‹è¿™åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œã€‚</p>
<h2 id="é¡¹ç›®ç›®å½•åˆ†æ">é¡¹ç›®ç›®å½•åˆ†æ</h2>
<figure data-type="image" tabindex="1"><img src="https://evansalien.github.io/post-images/1584343182945.png" alt="" loading="lazy"></figure>
<h3 id="å…·ä½“æˆ‘ä»¬æ¥åˆ†æ-srccoreç›®å½•ä¸‹çš„ä¸œè¥¿">å…·ä½“æˆ‘ä»¬æ¥åˆ†æ src/coreç›®å½•ä¸‹çš„ä¸œè¥¿</h3>
<p><strong>åœ¨src/core/index.js</strong><br>
import Vue from './instance/index'</p>
<p><strong>åœ¨src/core/instance/index.js</strong></p>
<pre><code class="language-javascript">import { initMixin } from './init'
import { stateMixin } from './state'
import { renderMixin } from './render'
import { eventsMixin } from './events'
import { lifecycleMixin } from './lifecycle'
import { warn } from '../util/index'

function Vue(options) {
  if (process.env.NODE_ENV !== 'production' &amp;&amp;
    !(this instanceof Vue)
  ) {
    warn('Vue is a constructor and should be called with the `new` keyword')
  }
  this._init(options)
}

initMixin(Vue)
stateMixin(Vue)
eventsMixin(Vue)
lifecycleMixin(Vue)
renderMixin(Vue)

export default Vue
</code></pre>
<ul>
<li>initMixin ï¼šå¯¹äºå„ç§vueå®ä¾‹å„ç§å±æ€§è¿›è¡Œåˆå§‹åŒ–</li>
<li>stateMixin ï¼šVueåŸå‹ä¸Šç»‘å®šstateç›¸å…³çš„æ–¹æ³•å’Œå±æ€§ï¼Œdataã€propsç­‰</li>
<li>eventsMixin ï¼šVueåŸå‹ä¸Šç»‘å®šäº‹ä»¶ç›¸å…³æ–¹æ³•</li>
<li>lifecycleMixin ï¼šVueåŸå‹ä¸Šç»‘å®šç”Ÿå‘½å‘¨æœŸç›¸å…³æ–¹æ³•ï¼Œæ¯”å¦‚_updateã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>U</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">ã€</mi></mrow><annotation encoding="application/x-tex">forceUpdateã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault">p</span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord cjk_fallback">ã€</span></span></span></span>destroy</li>
<li>renderMixin : VueåŸå‹ä¸Šç»‘å®šå’Œæ¸²æŸ“ç›¸å…³çš„æ–¹æ³•</li>
</ul>
<h4 id="initmixin">initMixin</h4>
<p><strong>åœ¨src/core/instance/init.js</strong></p>
<ul>
<li><strong>ç¬¬ä¸€ç‚¹</strong>ï¼šinitMixin æ˜¯Vueçš„ä¸€äº›åˆå§‹åŒ–å®ä¾‹çš„æ–¹æ³•ï¼Œåœ¨è¿˜æ²¡æœ‰æ„é€ ä¸€ä¸ªå¯¹è±¡å‰æ˜¯ä¸ä¼šè¿›å…¥åˆ°è¿™ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œå½“é€šè¿‡newå‡ºä¸€ä¸ªå¯¹è±¡åæ‰ä¼šè¿›å…¥ï¼ŒåŸå› å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="language-javascript">Vue.prototype._init = function (options?: Object) {}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªoptions?:objectçš„æ ¡éªŒï¼Œåˆšå¼€å§‹å³åªæ˜¯å¼•å…¥<script src="../../dist/vue.js"></script>è¿™ä¸ªæ–‡ä»¶ï¼Œå½“var vm = new Vue()ä¹‹åæ‰è¿›å…¥_initæ–¹æ³•å†…éƒ¨ã€‚</p>
<ul>
<li><strong>ç¬¬äºŒç‚¹</strong>ï¼š_initæ–¹æ³•ä¸­å¯¹äº$optionsè®¾ç½®ï¼š</li>
</ul>
<pre><code class="language-javascript"> vm.$options = mergeOptions(
        resolveConstructorOptions(vm.constructor),
        options || {},
        vm
      )
</code></pre>
<ul>
<li><strong>ç¬¬ä¸‰ç‚¹</strong>ï¼š_initæ–¹æ³•ä¸­å…¶ä»–åˆå§‹åŒ–æ–¹æ³•ï¼š</li>
</ul>
<pre><code class="language-javascript">    initLifecycle(vm)
    initEvents(vm)
    initRender(vm)
    callHook(vm, 'beforeCreate')
    initInjections(vm) // resolve injections before data/props
    initState(vm)
    initProvide(vm) // resolve provide after data/props
    callHook(vm, 'created')
</code></pre>
<p>æ¥ä¸‹æ¥å°†ä¼šä¸€ä¸ªä¸ªåˆå§‹åŒ–æ–¹æ³•è¯´æ˜ï¼Œåˆæ¬¡ä¹‹å¤–_initæ–¹æ³•è¿˜æœ‰ä¸€äº›å˜é‡çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚_uidã€_isVueã€_nameã€_renderProxyçš„åˆå§‹åŒ–</p>
<ul>
<li><strong>ç¬¬å››ç‚¹</strong>ï¼šæœ€ååœ¨_initæ–¹æ³•ä¸­éœ€è¦æ³¨æ„</li>
</ul>
<pre><code class="language-javascript"> if (vm.$options.el) {
      vm.$mount(vm.$options.el)
    }
</code></pre>
<p>è°ƒç”¨$mount æŒ‚åœ¨æ ¹å…ƒç´ ä¸Š</p>
<h4 id="statemixin">stateMixin</h4>
<p><strong>src/core/instance/state.js</strong></p>
<ul>
<li>
<p><strong>ç¬¬ä¸€ç‚¹</strong>ï¼š stateMixinæ˜¯å¯¹äºVueåŸå‹å¯¹è±¡(Vue.prototype)åŠ ä¸Š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi mathvariant="normal">ã€</mi></mrow><annotation encoding="application/x-tex">dataã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord cjk_fallback">ã€</span></span></span></span>propsã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">ã€</mi></mrow><annotation encoding="application/x-tex">deleteã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord cjk_fallback">ã€</span></span></span></span>watchã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>e</mi><mi>t</mi><mi mathvariant="normal">å±</mi><mi mathvariant="normal">æ€§</mi><mi mathvariant="normal">ã€‚</mi><mi mathvariant="normal">å¹¶</mi><mi mathvariant="normal">ä¸”</mi><mi mathvariant="normal">é€š</mi><mi mathvariant="normal">è¿‡</mi><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi mathvariant="normal">å¯¹</mi></mrow><annotation encoding="application/x-tex">setå±æ€§ã€‚å¹¶ä¸”é€šè¿‡Object.definePropertyå¯¹</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord cjk_fallback">å±</span><span class="mord cjk_fallback">æ€§</span><span class="mord cjk_fallback">ã€‚</span><span class="mord cjk_fallback">å¹¶</span><span class="mord cjk_fallback">ä¸”</span><span class="mord cjk_fallback">é€š</span><span class="mord cjk_fallback">è¿‡</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord">.</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord cjk_fallback">å¯¹</span></span></span></span>dataã€$propså±æ€§è¿›è¡Œsetå’Œgetã€‚</p>
</li>
<li>
<p><strong>ç¬¬äºŒç‚¹</strong>ï¼šinitStateæ–¹æ³•æ˜¯åœ¨init.jsä¸­è°ƒç”¨ï¼Œå³å®ä¾‹åŒ–ä¹‹åæ‰è°ƒç”¨çš„ï¼Œæ˜¯ä¸ªå®ä¾‹å¯¹è±¡æ·»åŠ å±æ€§ã€‚</p>
</li>
</ul>
<pre><code class="language-javascript">export function initState(vm: Component) {
// é¦–å…ˆåœ¨vmä¸Šåˆå§‹åŒ–ä¸€ä¸ª_watchersæ•°ç»„ï¼Œç¼“å­˜è¿™ä¸ªvmä¸Šçš„æ‰€æœ‰watcher
  vm._watchers = []
  const opts = vm.$options
  if (opts.props) initProps(vm, opts.props)
  if (opts.methods) initMethods(vm, opts.methods)
  if (opts.data) {
    initData(vm)
  } else {
    observe(vm._data = {}, true /* asRootData */)
  }
  if (opts.computed) initComputed(vm, opts.computed)
  if (opts.watch &amp;&amp; opts.watch !== nativeWatch) {
    initWatch(vm, opts.watch)
  }
}
</code></pre>
<p>å¯¹äºå®ä¾‹å¯¹è±¡è¿›è¡Œç›¸å…³å±æ€§çš„åˆå§‹åŒ–ï¼Œå¦å¤–dataã€propså› ä¸ºéœ€è¦åŒå‘ç»‘å®šï¼Œåœ¨initDataã€initPropsä¸­éƒ½æœ‰ä¸€ä¸ªproxyæ–¹æ³•å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œsetå’Œgetçš„è®¾ç½®</p>
<h4 id="eventmixin">eventMixin</h4>
<ul>
<li>
<p><strong>ç¬¬ä¸€ç‚¹</strong>ï¼š eventsMixinæ˜¯å¯¹äºVueåŸå‹å¯¹è±¡(Vue.prototype)ç»‘å®šä¸€äº›äº‹ä»¶æ–¹æ³•ï¼Œæ¯”å¦‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>o</mi><mi>n</mi><mi mathvariant="normal">ã€</mi></mrow><annotation encoding="application/x-tex">onã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord cjk_fallback">ã€</span></span></span></span>onceã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>o</mi><mi>f</mi><mi>f</mi><mi mathvariant="normal">ã€</mi></mrow><annotation encoding="application/x-tex">offã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord cjk_fallback">ã€</span></span></span></span>emitã€‚</p>
</li>
<li>
<p><strong>ç¬¬äºŒç‚¹</strong>ï¼š initEventsæ˜¯å¯¹äºå®ä¾‹å¯¹è±¡åˆå§‹åŒ–äº‹ä»¶</p>
</li>
</ul>
<pre><code class="language-javascript">export function initEvents(vm: Component) {
  vm._events = Object.create(null)
  vm._hasHookEvent = false
  // init parent attached events åˆå§‹åŒ–çˆ¶çº§ç›¸å…³äº‹ä»¶
  const listeners = vm.$options._parentListeners
  if (listeners) {
    updateComponentListeners(vm, listeners)
  }
}
</code></pre>
<p>åˆ›å»º_eventsä¸€ä¸ªç©ºå¯¹è±¡ä¹‹åç”¨æ¥å­˜æ”¾äº‹ä»¶ï¼Œ_hasHookEventæ˜¯ä¸€ä¸ªä¼˜åŒ–æ ‡è®°ï¼ˆå¯ä»¥æš‚æ—¶ä¸ç†ä¼šï¼‰ï¼Œç„¶ååˆå§‹åŒ–çˆ¶çº§äº‹ä»¶ã€‚æ ¹æ®æ˜¯å¦æœ‰çˆ¶çº§ç›‘å¬äº‹ä»¶ï¼Œå¦‚æœæœ‰åˆ™æ›´æ–°çˆ¶çº§äº‹ä»¶</p>
<h4 id="lifecyclemixin">lifecycleMixin</h4>
<ul>
<li><strong>ç¬¬ä¸€ç‚¹</strong>ï¼š lifecycleMixinæ˜¯å¯¹VueåŸå‹å¯¹è±¡(Vue.prototype)ç»‘å®š_updateã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>U</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">ã€</mi></mrow><annotation encoding="application/x-tex">forceUpdateã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault">p</span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord cjk_fallback">ã€</span></span></span></span>destroyä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚_updateæ–¹æ³•ä¸­é€šè¿‡è°ƒç”¨__patch__æ–¹æ³•æ›´æ–°è™šæ‹Ÿdomï¼›</li>
</ul>
<pre><code class="language-javascript">if (!prevVnode) {
      // initial render
      vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */)
    } else {
      // updates
      vm.$el = vm.__patch__(prevVnode, vnode)
    }
</code></pre>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>U</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">å¼º</mi><mi mathvariant="normal">åˆ¶</mi><mi mathvariant="normal">é‡</mi><mi mathvariant="normal">æ–°</mi><mi mathvariant="normal">æ¸²</mi><mi mathvariant="normal">æŸ“</mi><mi mathvariant="normal">å®</mi><mi mathvariant="normal">ä¾‹</mi><mi mathvariant="normal">æœ¬</mi><mi mathvariant="normal">èº«</mi><mi mathvariant="normal">å’Œ</mi><mi mathvariant="normal">æ’</mi><mi mathvariant="normal">å…¥</mi><mi mathvariant="normal">æ’</mi><mi mathvariant="normal">æ§½</mi><mi mathvariant="normal">å†…</mi><mi mathvariant="normal">å®¹</mi><mi mathvariant="normal">çš„</mi><mi mathvariant="normal">å­</mi><mi mathvariant="normal">ç»„</mi><mi mathvariant="normal">ä»¶</mi><mi mathvariant="normal">ï¼›</mi></mrow><annotation encoding="application/x-tex">forceUpdateå¼ºåˆ¶é‡æ–°æ¸²æŸ“å®ä¾‹æœ¬èº«å’Œæ’å…¥æ’æ§½å†…å®¹çš„å­ç»„ä»¶ï¼›</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault">p</span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord cjk_fallback">å¼º</span><span class="mord cjk_fallback">åˆ¶</span><span class="mord cjk_fallback">é‡</span><span class="mord cjk_fallback">æ–°</span><span class="mord cjk_fallback">æ¸²</span><span class="mord cjk_fallback">æŸ“</span><span class="mord cjk_fallback">å®</span><span class="mord cjk_fallback">ä¾‹</span><span class="mord cjk_fallback">æœ¬</span><span class="mord cjk_fallback">èº«</span><span class="mord cjk_fallback">å’Œ</span><span class="mord cjk_fallback">æ’</span><span class="mord cjk_fallback">å…¥</span><span class="mord cjk_fallback">æ’</span><span class="mord cjk_fallback">æ§½</span><span class="mord cjk_fallback">å†…</span><span class="mord cjk_fallback">å®¹</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">å­</span><span class="mord cjk_fallback">ç»„</span><span class="mord cjk_fallback">ä»¶</span><span class="mord cjk_fallback">ï¼›</span></span></span></span>destroyé”€æ¯ä¸€ä¸ªå®ä¾‹ï¼Œæ¸…ç†å®ƒä¸å…¶å®ƒå®ä¾‹çš„è¿æ¥ï¼Œè§£ç»‘å®ƒçš„å…¨éƒ¨æŒ‡ä»¤åŠäº‹ä»¶ç›‘å¬å™¨ï¼Œè§¦å‘ beforeDestroy å’Œ destroyed çš„é’©å­</p>
<ul>
<li><strong>ç¬¬äºŒç‚¹</strong>ï¼š initLifecycleæ˜¯åœ¨_initæ–¹æ³•ä¸­è°ƒç”¨ï¼Œæ˜¯å®ä¾‹ç”Ÿå‘½å‘¨æœŸçš„åˆå§‹åŒ–ï¼Œå…¶ä¸­ä¼šåŒ…æ‹¬å¾ˆå¤šå˜é‡</li>
</ul>
<pre><code class="language-javascript">export function initLifecycle(vm: Component) {
  const options = vm.$options

  // locate first non-abstract parent åˆ›å»ºç¬¬ä¸€ä¸ªéæŠ½è±¡çˆ¶ç»„ä»¶ï¼ŒæŠ½è±¡ç»„ä»¶ï¼šå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“ä¸€ä¸ª DOM å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ï¼Œä¾‹å¦‚&lt;keep-alive&gt;
  let parent = options.parent
  if (parent &amp;&amp; !options.abstract) {
    while (parent.$options.abstract &amp;&amp; parent.$parent) {
      parent = parent.$parent
    }
    parent.$children.push(vm)
  }

  vm.$parent = parent
  vm.$root = parent ? parent.$root : vm

  vm.$children = []
  vm.$refs = {}

  vm._watcher = null // watcherå¯¹è±¡
  vm._inactive = null // å’Œkeep-aliveä¸­ç»„ä»¶çŠ¶æ€æœ‰å…³ç³»
  vm._directInactive = false // å’Œkeep-aliveä¸­ç»„ä»¶çŠ¶æ€æœ‰å…³ç³»
  vm._isMounted = false //å½“å‰å®ä¾‹æ˜¯å¦è¢«æŒ‚è½½
  vm._isDestroyed = false // å½“å‰å®ä¾‹æ˜¯å¦è¢«é”€æ¯
  vm._isBeingDestroyed = false // å½“å‰å®ä¾‹æ˜¯å¦æ­£åœ¨è¢«é”€æ¯æˆ–è€…æ²¡é”€æ¯å®Œå…¨
}
</code></pre>
<ul>
<li><strong>ç¬¬ä¸‰ç‚¹</strong>ï¼š callHookæ˜¯åœ¨_initæ–¹æ³•ä¸­è°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç›´æ¥è°ƒç”¨é’©å­ï¼Œè°ƒç”¨å½¢å¼å¦‚ä¸‹</li>
</ul>
<pre><code class="language-javascript">callHook(vm, 'beforeCreate')
callHook(vm, 'created')
</code></pre>
<h4 id="renderminix">RenderMinix</h4>
<p><strong>src/core/instance/render.js</strong></p>
<ul>
<li><strong>ç¬¬ä¸€ç‚¹</strong>ï¼š renderMixinæ–¹æ³•ä¸»è¦æ˜¯ç»™VueåŸå‹å¯¹è±¡ç»‘å®š$nextTickã€_renderä¸¤ä¸ªæ–¹æ³•,å…¶ä¸­_renderæ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="language-javascript">Vue.prototype._render = function (): VNode {
    â€¦â€¦
    // set parent vnode. this allows render functions to have access
    // to the data on the placeholder node.
    vm.$vnode = _parentVnode
    // render self
    let vnode
    try {
      vnode = render.call(vm._renderProxy, vm.$createElement)
    } catch (e) {
      handleError(e, vm, `render`)
      if (process.env.NODE_ENV !== 'production') {
        if (vm.$options.renderError) {
          try {
            vnode = vm.$options.renderError.call(vm._renderProxy, vm.$createElement, e)
          } catch (e) {
            handleError(e, vm, `renderError`)
            vnode = vm._vnode
          }
        } else {
          vnode = vm._vnode
        }
      } else {
        vnode = vm._vnode
      }
    }
    â€¦â€¦
    return vnode
  }
</code></pre>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¸»è¦æ˜¯tryâ€¦â€¦catchè¿™é‡Œåˆ›å»ºäº†vnodeã€‚<br>
vnode = render.call(vm._renderProxy, vm.$createElement) åˆ›å»ºä¸€ä¸ªvnodeå¹¶ä¸”è¿”å›ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›ä¸€ä¸ªç©ºçš„vnode vnode = createEmptyVNode()</p>
<ul>
<li><strong>ç¬¬äºŒç‚¹</strong>ï¼š initRenderæ˜¯åœ¨_initæ–¹æ³•ä¸­è°ƒç”¨ï¼Œè¿›è¡Œå®ä¾‹æ¸²æŸ“å±æ€§çš„ç»‘å®šå¹¶ä¸”å¯¹ä¸€äº›å±æ€§çš„ç›‘å¬</li>
</ul>
<pre><code class="language-javascript">export function initRender(vm: Component) {
  â€¦â€¦
  vm._c = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, false)
  // normalization is always applied for the public version, used in
  // user-written render functions.
  vm.$createElement = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, true)
  â€¦â€¦
}
</code></pre>
<p>è¿™é‡Œç€é‡å…³æ³¨ä¸€ä¸‹createElementæ–¹æ³•ï¼Œä¼ å…¥vnodeä»¥åŠdomçš„å±æ€§åˆ›å»ºçœŸæ­£domèŠ‚ç‚¹ã€‚</p>
<h2 id="æºç æ„å»ºåŸºäº-rollup">æºç æ„å»ºï¼ŒåŸºäº Rollup</h2>
<figure data-type="image" tabindex="2"><img src="https://evansalien.github.io/post-images/1584343201997.png" alt="" loading="lazy"></figure>
<p>æ€»ç»“ï¼š<strong>Runtime Onlyï¼šé€šå¸¸éœ€è¦å€ŸåŠ©å¦‚ webpack çš„ vue-loader å·¥å…·æŠŠ .vue æ–‡ä»¶ç¼–è¯‘æˆJavaScriptï¼Œå› ä¸ºæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µåš çš„ï¼Œæ‰€ä»¥å®ƒåªåŒ…å«è¿è¡Œæ—¶çš„ Vue.js ä»£ç ï¼Œå› æ­¤ä»£ç ä½“ç§¯ ä¹Ÿä¼šæ›´è½»é‡ã€‚ Runtime + Compilerï¼šæˆ‘ä»¬å¦‚æœæ²¡æœ‰å¯¹ä»£ç åšé¢„ç¼–è¯‘ï¼Œä½† åˆä½¿ç”¨äº† Vue çš„ template å±æ€§å¹¶ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™éœ€ è¦åœ¨å®¢æˆ·ç«¯ç¼–è¯‘æ¨¡æ¿ã€‚ Vue.js 2.0 ä¸­ï¼Œæœ€ç»ˆæ¸²æŸ“éƒ½æ˜¯é€š è¿‡ render å‡½æ•°ï¼Œå¦‚æœå†™ template å±æ€§ï¼Œåˆ™éœ€è¦ç¼–è¯‘æˆ render å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªç¼–è¯‘è¿‡ç¨‹ä¼šå‘ç”Ÿè¿è¡Œæ—¶ï¼Œæ‰€ä»¥éœ€ è¦å¸¦æœ‰ç¼–è¯‘å™¨çš„ç‰ˆæœ¬ã€‚</strong></p>
<h2 id="vueçš„æœ¬è´¨æ„é€ å‡½æ•°">Vueçš„æœ¬è´¨ï¼šæ„é€ å‡½æ•°</h2>
<pre><code class="language-javascript">    function Vue (options) {
    if (process.env.NODE_ENV !== 'production' &amp;&amp;
        !(this instanceof Vue)
    ) {
        warn('Vue is a constructor and should be called with the `new`  keyword')
    }
    this._init(options)
    }
</code></pre>
<p>æ€»ç»“ï¼š<strong>vue æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç”¨ Function å®ç°çš„ Classï¼Œç„¶ååœ¨å®ƒ çš„åŸå‹ prototype ä»¥åŠå®ƒæœ¬èº«ä¸Šæ‰©å±•äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å’Œå± æ€§ã€‚Vue ä¸ç”¨ ES6 çš„ Class å»å®ç°çš„åŸå› ï¼šæŒ‰åŠŸèƒ½åŒºåˆ†ï¼ŒæŠŠ åŠŸèƒ½æ‰©å±•åˆ†æ•£åˆ°å¤šä¸ªæ¨¡å—ä¸­å»å®ç°ï¼Œç„¶åæŒ‚è½½ä¸­ vue çš„ åŸå‹ prototype ä¸Šï¼Œä¹Ÿæœ‰åœ¨ Vue è¿™ä¸ªå¯¹è±¡æœ¬èº« ä¸Šã€‚è€Œä¸æ˜¯åœ¨ä¸€ä¸ªæ¨¡å—é‡Œå®ç°æ‰€æœ‰ï¼Œè¿™ç§æ–¹å¼æ˜¯ç”¨ Class éš¾ä»¥ å®ç°çš„ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯éå¸¸æ–¹ä¾¿ä»£ç çš„ç»´æŠ¤å’Œç®¡ç†</strong></p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E6%9D%A5%E6%BA%90">æ¥æº</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E5%88%86%E6%9E%90">é¡¹ç›®ç›®å½•åˆ†æ</a>
<ul>
<li><a href="#%E5%85%B7%E4%BD%93%E6%88%91%E4%BB%AC%E6%9D%A5%E5%88%86%E6%9E%90-srccore%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E4%B8%9C%E8%A5%BF">å…·ä½“æˆ‘ä»¬æ¥åˆ†æ src/coreç›®å½•ä¸‹çš„ä¸œè¥¿</a>
<ul>
<li><a href="#initmixin">initMixin</a></li>
<li><a href="#statemixin">stateMixin</a></li>
<li><a href="#eventmixin">eventMixin</a></li>
<li><a href="#lifecyclemixin">lifecycleMixin</a></li>
<li><a href="#renderminix">RenderMinix</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%BA%90%E7%A0%81%E6%9E%84%E5%BB%BA%E5%9F%BA%E4%BA%8E-rollup">æºç æ„å»ºï¼ŒåŸºäº Rollup</a></li>
<li><a href="#vue%E7%9A%84%E6%9C%AC%E8%B4%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">Vueçš„æœ¬è´¨ï¼šæ„é€ å‡½æ•°</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://evansalien.github.io/post/liu-lan-qi-xuan-ran-pian-xia/">
              <h3 class="post-title">
                æµè§ˆå™¨-æ¸²æŸ“ç¯‡(ä¸‹)
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/EvansAlien/evansalien.github.io" target="_blank">Evans Alien</a>
  <a class="rss" href="https://evansalien.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
